<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src='https://cdn.jsdelivr.net/gh/MeetMartin/nlpjs-web/dist/bundle.js'></script>
    
    <!-- Bootstrap CSS -->

    <!-- Font Awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link rel="stylesheet" href="static/style.css">
<style>
  
  .repl {
    text-shadow: none;
    color: #333;
    background: #f8f8f8;
    padding: 0;
    text-align: left;
    width: 600px;
    margin: 50px auto;
    border-radius: 3px;
    border: 1px solid #ddd;
    overflow:hidden;
}

.repl code {
    height: 200px;
    overflow-y: scroll;
}

  .user-card-body {
 /* OLD COLOR
  background-color: #ff0080;
 */
  background-color: #1ca315;
  color: white;
  border-radius: 40px;
}

.bot-card-body {
  background-color: #f7f7f7;
  border-radius: 40px;
}

.card {
  border-radius: 40px;
}
  
 /* styling used  for the Termino.js - terminal demo(s) */   
.repl {
    text-shadow: none;
    color: #333;
    background: #f8f8f8;
    padding: 0;
    text-align: left;
    width: 600px;
    margin: 50px auto;
    border-radius: 3px;
    border: 1px solid #ddd;
    overflow:hidden;
}

.repl code {
    height: 200px;
    overflow-y: scroll;
}

pre {
    margin: 0;
}

.termino-console {
    padding: 11px 16px;
    display: block;
}

.termino-input-container {
    display: flex;
}

.termino-input-container > * {
    outline: none;
    border: none;
    white-space: pre-wrap;
    font-family: monospace;
    color: #444;
    background: #f0f0f0;
    min-height: 14px; /* minimum one line */
    padding: 10px;
    margin: 0;
    border-radius: 0 0 3px 3px;
    border-top: 1px solid #ddd;
}

.termino-input {
    flex: 1;
    height: 100%; /* start off one line tall */
    padding-left: 0;
}

.termino-prompt {a
    font-weight: bold;
    padding: 8px 10px;
}
    </style>
    <title>Chatbot</title>
  </head>
  <body>
  <section class="section--standalone" id="Example_Terminal_2">
    <div class="repl">
      <pre><code class="termino-console"></code></pre>
        <div class="termino-input-container">
         
            <label id="termino-prompt" for="termino-input">â†’ </label>
            <textarea  class="termino-input"   rows="1" wrap="hard" placeholder="This is just a demo animation!"></textarea>
        </div>
    </div> 
    <!-- Optional JavaScript -->
  </body>
   <script type="module">
    // Termino.js - Terminal App Demo (Basic)
import {Termino} from 'https://cdn.jsdelivr.net/gh/MarketingPipeline/Termino.js@v1.0.0/dist/termino.min.js';
     
 import {fetch_tmdb_info, tmdb_api_key} from 'https://cdn.jsdelivr.net/gh/MarketingPipeline/TheMovieDB-API-Wrapper.js/dist/themoviedb-api-wrapper.min.js' 

tmdb_api_key("PUT YOUR API KEY HERE")

     
    

function SearchInput(input, option, option2){
  
  // Used to set reviews / similar etc.. 
  if (option2 != "movie" && option2 != "tv"){
    option2 = 2 // Max actors to return.. 
  } else{
    option2 = option2
  }
   
let t= fetch_tmdb_info(input, option,  option2).then(function(search_results) {  
 // console.log(search_results)
 if(search_results.tmdb_api_error){
   return search_results.tmdb_api_error
  }
  
  
  
  let genres = [];  
  let actors = []; 
  let appears_in = []
  let resp = [];
  
  
  function getActorsAndGenres(){
    for(const name in search_results[0][0].genres){
     genres += `${search_results[0][0].genres[name].name},`
   }    
  
  
    for(const names in search_results[1]){
     if(search_results[1][names].name != "undefined"){
     actors += search_results[1][names].name
     } 
   }    
  }
  
  if (option == "movie"){
   
      return(`
 ${search_results[0][0].title}  on TMDb:
 
  Duration: .... ${search_results[0][0].runtime}
  Stars: ....... ${search_results[0][0].overview}
  Genre: ....... ${actors}
  Plot: ... ${search_results[0][0].overview}`)
  }

  if(option == "similar"){  
    if(option2 != "tv"){
     for (const known_fors in search_results.results){
    resp += `${search_results.results[known_fors].title + search_results.results[known_fors].release_date.split("-")[0]}<br>`
       
     } 
    }else{
        for (const known_fors in search_results.results){
    resp += `${search_results.results[known_fors].name + search_results.results[known_fors].first_air_date.split("-")[0]}<br>`
        }
    } 

    return  `
Similar ${option2} on TMDb:
 
Results.... 
${resp}
 
`
  }
  
   
  if(option == "reviews"){  
     for(const review in search_results.results){
      
      resp += `Author.....  ${search_results.results[review].author}
Rating.....  ${search_results.results[review].author_details.rating}
Review.....  ${search_results.results[review].content}`
    }
    return resp //
  }
  
   
  if(option == "collection"){   
      return(`Author.....  ${search_results[0].name}
Rating.....  ${search_results[0].overview}
Review.....  ${search_results[0].poster_path}`)
    
    
   
   
  } 
  
  if (option == "tv"){
    
    getActorsAndGenres()
    
    
        return(`
 ${search_results[0][0].name}  on TMDb:
  
  Seasons: .... ${search_results[0][0].number_of_seasons}
  Stars: ....... ${actors}
  Genre: ....... ${genres}
  Plot: ... ${search_results[0][0].overview}`)
  }
  
  if (option == "actor"){
    for (const known_for in search_results[0].known_for){
      appears_in += search_results[0].known_for[known_for].title + ` (${search_results[0].known_for[known_for].release_date.split("-")[0]})`
    }
     t =  `
 ${search_results[0].name}  on TMDb:
 
 Appears in.... 
 ${appears_in}
 
`
     return t
  }
   
  
  
  });
  return t
}
    
const {containerBootstrap, Nlp, LangEn, fs} = window.nlpjs;
          
        function User_MSG(msg){
          return `<div class="d-flex justify-content-end">
      <div class="card mb-3">
        <div class="card-body user-card-body">
          <p class="card-text">${msg}</p>
        </div>
      </div>
      </div>
      `
        }
     
     
        function Bot_MSG(message, type){
          
          if (type == "output"){
            type = term2.output
          } else{
            type = term2.input
          }
         return type(`<div class="d-flex justify-content-start">
        <div class="card mb-3">
          <div class="card-body bot-card-body">
            <p class="card-text">${message}</p>
          </div>
        </div>
      </div>
      `)  
        
        }
          
     // GREETING INTENT FUNCTIONS
     
     var greetings = {
  movie: async function() {
     
    /// FUNCTION TO SEARCH TMDB    
     let tt = await Bot_MSG(`What do you want to search? <br>
              1. <button id="btn">fd</button>Movie
              2. Actor
              3. Movie Collection
              4. TV Show
              5. TV / Movie Reviews
              7. Similar movie`)   
     
     
     let functions = ["movie", "actor", "reviews", "tv shows", "collection", "similar"]
     
      for (const option in functions){
            if (tt.toLowerCase() === functions[option]) { 

            let search_input = await Bot_MSG(`What name do you want to search for ${functions[option]} details?`)  
             
              let results; 
           
              
              
              if (tt.toLowerCase() == "tv shows"){
                results =  await SearchInput(search_input, "tv")
              } else{
                
                 if (tt.toLowerCase() == "similar"){
                 results = await Bot_MSG(`Is this title a TV show or Movie?`)  
                     if (results != "movie" && results != "tv"){
                       Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    return 
  }
                   
                results =  await SearchInput(search_input, "similar",  results)
              }
                
                
                 if (functions[option] == "reviews"){
                 results = await Bot_MSG(`Is this title a TV show or Movie?`)   
                     if (results != "movie" && results != "tv"){
                       Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    return 
  }
                   
                results =  await SearchInput(search_input, "reviews", results)
              } 
                
          if (tt.toLowerCase() != "reviews" && tt.toLowerCase() != "similar"){ 
               
              results =  await SearchInput(search_input, functions[option])
              }
              }
               
             Bot_MSG("Just a moment while I search for that!", "output")
              
              
          await term2.delay(results)
           
             if (results == "No results found"){
               // Title is not real / or not found...
               Bot_MSG(`No results found for ${search_input}`, "output")
                return;
             } else{ 
               if(results.includes("Invalid API")){
                 Bot_MSG(`Error: ${results}`, "output")
               }else{
               /// Collect data possibly - title is REAL etc..
                Bot_MSG(`Here are the results for ${tt}: ${results}`, "output")
               }
                return;
             }     
             
           } 
           
         }
            Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    
   
  },
  hello: function (){
     /// FUNCTION TO SAY HELLO BASED ON HOUR OF DAY.
        const hours = new Date().getHours();
          let answer;
                if(hours < 12) {
                    answer = 'Good morning!';
                } else if(hours < 17) {
                    answer = 'Good afternoon!';
                } else {
                    answer = 'Good evening!';
                }
    return answer
     },
   searchGitHubProfile: async function SearchGitHubProfile() {


try {

let username = await Bot_MSG("What profile would you like to search?")
if (!username) {
throw {
message: "No username was provided"
}
}
const response = await fetch(`https://api.github.com/users/${username}`)
let data = await response.json();
if (data.login === undefined) {
throw {
message: "profile was not found"
}
}

Bot_MSG(`You searched for: ${data.login}, they have ${data.followers} followers, & ${data.public_repos} public repos`, "output")
} catch (error) {
  Bot_MSG(`Failed to get github info ${error.message}`, "output")

}

return;

}
    
};
     
  
     
        async function onIntent(nlp, input) {
           
           const output = input; 
           if (input.intent === 'None') {
            output.answer = 'I am not sure what you mean by that'
             
             // If no response was found - you could send the input to a API to store the input to make new responses (manually) & improve the chatbot!
           }
          
          
          
           // Handle your custom functions with Termino.JS on ChatBot intents here! 
          
          let functions = ['greetings.hello', 'search.github']
          
          for (const option in functions){
            if (input.intent === functions[option]) {  
              output.answer = await eval(functions[option] + "()")  
            }
          } 
            if (output.answer != undefined){
            Bot_MSG(output.answer, "output");
              return input;
            }
            
        }

        const setupNLP = async corpus => {
            const container = containerBootstrap();
            container.register('fs', fs);
            container.use(Nlp);
            container.use(LangEn);
            const nlp = container.get('nlp');
            nlp.onIntent = onIntent;
            nlp.settings.autoSave = false;
            await nlp.addCorpus(corpus);
            nlp.train();
            return nlp;
        };
               // This is where all the responses for chatbot come from! You can make your own corpus data to fit your own chat bot needs! 
            const nlp = await setupNLP('https://raw.githubusercontent.com/jesus-seijas-sp/nlpjs-examples/master/01.quickstart/05.consoleconnector/corpus-en.json');
 
    
// initialize a Terminal via Termino.js
let term2 = Termino(document.getElementById("Example_Terminal_2"))


  
 
async function basicTerminalApp() {

// call Termino.js / your terminal for inital input
let term2value = await term2.input("")


            const response = await nlp.process('en', term2value);
       
  //  NEED TO FIGURE OUT FIX FOR CSS / SCROLL TO BOTTOM - BOOTSTRAP ISSUE - TERMINO.JS HAS BUILT IT SCROLL TO BOTTOM ON COMMANDS.
//  window.scrollTo(0, document.body.scrollHeight);
  
// repeat
setTimeout(basicTerminalApp, term2value)


}

basicTerminalApp()
  </script> 
</html>
