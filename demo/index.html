<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<script src='https://cdn.jsdelivr.net/gh/MeetMartin/nlpjs-web/dist/bundle.js'></script>
    
    
       <script type="module">
    // Termino.js - Terminal App Demo (Basic)
import {Termino} from "https://cdn.jsdelivr.net/gh/MarketingPip/Termino.js@MarketingPip-WIP/src/termino10.js"
 
  
         
         
  function getTime() {
  var date = new Date();
  var hours = date.getHours();
  var minutes = date.getMinutes();
  var ampm = hours >= 12 ? 'PM' : 'AM';
  hours = hours % 12;
  hours = hours ? hours : 12; // the hour '0' should be '12'
  minutes = minutes < 10 ? '0' + minutes : minutes;
  var strTime = hours + ':' + minutes + ' ' + ampm;
  return strTime;
}       
   
         
         
   
 let TimeStamp_Template = `<p class="timestamp-user">${getTime()}</p>`

   
   
 let DEF_SETTINGS = {
      allow_scroll: true, // allow scroll up & down on terminal 
      prompt: `<div class="d-flex justify-content-end">${TimeStamp_Template}<div class="message-bubble user">{{command}}</div></div>`, // default prompt / echo message -  {{command}} is required
      input: "{{command}}", // input message - {{command}} is required
      output: "{{command}}", // output message - {{command}} is required
      command_key: 13, // default command key
      terminal_killed_placeholder: "TERMINAL DISABLED", // default terminal input placeholder when killed. 
      terminal_output: ".termino-console", // default output query selector
      terminal_input: ".termino-input", // default input query selector
      disable_terminal_input: false, // disable any user commands / inputs. --- Useful for making terminal animations etc!
      speech_to_text:true, // Enable text to speech on output & inputs.
    }
     
 import {fetch_tmdb_info, tmdb_api_key} from 'https://cdn.jsdelivr.net/gh/MarketingPipeline/TheMovieDB-API-Wrapper.js/dist/themoviedb-api-wrapper.min.js' 

tmdb_api_key("PUT YOUR API KEY HERE")

     
    

function SearchInput(input, option, option2){
  
  // Used to set reviews / similar etc.. 
  if (option2 != "movie" && option2 != "tv"){
    option2 = 2 // Max actors to return.. 
  } else{
    option2 = option2
  }
   
let t= fetch_tmdb_info(input, option,  option2).then(function(search_results) {  
 // console.log(search_results)
 if(search_results.tmdb_api_error){
   return search_results.tmdb_api_error
  }
  
  
  
  let genres = [];  
  let actors = []; 
  let appears_in = []
  let resp = [];
  
  
  function getActorsAndGenres(){
    for(const name in search_results[0][0].genres){
     genres += `${search_results[0][0].genres[name].name},`
   }    
  
  
    for(const names in search_results[1]){
     if(search_results[1][names].name != "undefined"){
     actors += search_results[1][names].name
     } 
   }    
  }
  
  if (option == "movie"){
   
      return(`
 ${search_results[0][0].title}  on TMDb:
 
  Duration: .... ${search_results[0][0].runtime}
  Stars: ....... ${search_results[0][0].overview}
  Genre: ....... ${actors}
  Plot: ... ${search_results[0][0].overview}`)
  }

  if(option == "similar"){  
    if(option2 != "tv"){
     for (const known_fors in search_results.results){
    resp += `${search_results.results[known_fors].title + search_results.results[known_fors].release_date.split("-")[0]}<br>`
       
     } 
    }else{
        for (const known_fors in search_results.results){
    resp += `${search_results.results[known_fors].name + search_results.results[known_fors].first_air_date.split("-")[0]}<br>`
        }
    } 

    return  `
Similar ${option2} on TMDb:
 
Results.... 
${resp}
 
`
  }
  
   
  if(option == "reviews"){  
     for(const review in search_results.results){
      
      resp += `Author.....  ${search_results.results[review].author}
Rating.....  ${search_results.results[review].author_details.rating}
Review.....  ${search_results.results[review].content}`
    }
    return resp //
  }
  
   
  if(option == "collection"){   
      return(`Author.....  ${search_results[0].name}
Rating.....  ${search_results[0].overview}
Review.....  ${search_results[0].poster_path}`)
    
    
   
   
  } 
  
  if (option == "tv"){
    
    getActorsAndGenres()
    
    
        return(`
 ${search_results[0][0].name}  on TMDb:
  
  Seasons: .... ${search_results[0][0].number_of_seasons}
  Stars: ....... ${actors}
  Genre: ....... ${genres}
  Plot: ... ${search_results[0][0].overview}`)
  }
  
  if (option == "actor"){
    for (const known_for in search_results[0].known_for){
      appears_in += search_results[0].known_for[known_for].title + ` (${search_results[0].known_for[known_for].release_date.split("-")[0]})`
    }
     t =  `
 ${search_results[0].name}  on TMDb:
 
 Appears in.... 
 ${appears_in}
 
`
     return t
  }
   
  
  
  });
  return t
}
    
         
 
          const {containerBootstrap, Nlp, LangEn, fs} = window.nlpjs;

         
          
        function User_MSG(msg){
          return `<div class="d-flex justify-content-end"><div class="message-bubble user">${message}</div></div>`
        }
     
     
        function Bot_MSG(message, type){
          
          if (type == "output"){
            type = term2.output
          } else{
            type = term2.input
          }
        return type(`<div class="d-flex justify-content-start"><div class="message-bubble bot">${message}</div></div>`)  
        
        
        }
          
     // GREETING INTENT FUNCTIONS
     
     var greetings = {
  movie: async function() {
     
    /// FUNCTION TO SEARCH TMDB    
     let tt = await Bot_MSG(`What do you want to search? <br>
              1. <button id="btn">fd</button>Movie
              2. Actor
              3. Movie Collection
              4. TV Show
              5. TV / Movie Reviews
              7. Similar movie`)   
     
     
     let functions = ["movie", "actor", "reviews", "tv shows", "collection", "similar"]
     
      for (const option in functions){
            if (tt.toLowerCase() === functions[option]) { 

            let search_input = await Bot_MSG(`What name do you want to search for ${functions[option]} details?`)  
             
              let results; 
           
              
              
              if (tt.toLowerCase() == "tv shows"){
                results =  await SearchInput(search_input, "tv")
              } else{
                
                 if (tt.toLowerCase() == "similar"){
                 results = await Bot_MSG(`Is this title a TV show or Movie?`)  
                     if (results != "movie" && results != "tv"){
                       Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    return 
  }
                   
                results =  await SearchInput(search_input, "similar",  results)
              }
                
                
                 if (functions[option] == "reviews"){
                 results = await Bot_MSG(`Is this title a TV show or Movie?`)   
                     if (results != "movie" && results != "tv"){
                       Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    return 
  }
                   
                results =  await SearchInput(search_input, "reviews", results)
              } 
                
          if (tt.toLowerCase() != "reviews" && tt.toLowerCase() != "similar"){ 
               
              results =  await SearchInput(search_input, functions[option])
              }
              }
               
             Bot_MSG("Just a moment while I search for that!", "output")
              
              
          await term2.delay(results)
           
             if (results == "No results found"){
               // Title is not real / or not found...
               Bot_MSG(`No results found for ${search_input}`, "output")
                return;
             } else{ 
               if(results.includes("Invalid API")){
                 Bot_MSG(`Error: ${results}`, "output")
               }else{
               /// Collect data possibly - title is REAL etc..
                Bot_MSG(`Here are the results for ${tt}: ${results}`, "output")
               }
                return;
             }     
             
           } 
           
         }
            Bot_MSG("Invalid option chosen, you must choose a valid option provided!", "output")
    
   
  },
  hello: function (){
     /// FUNCTION TO SAY HELLO BASED ON HOUR OF DAY.
        const hours = new Date().getHours();
          let answer;
                if(hours < 12) {
                    answer = 'Good morning!';
                } else if(hours < 17) {
                    answer = 'Good afternoon!';
                } else {
                    answer = 'Good evening!';
                }
    return answer
     },
   searchGitHubProfile: async function SearchGitHubProfile() {


try {

let username = await Bot_MSG("What profile would you like to search?")
if (!username) {
throw {
message: "No username was provided"
}
}
const response = await fetch(`https://api.github.com/users/${username}`)
let data = await response.json();
if (data.login === undefined) {
throw {
message: "profile was not found"
}
}

Bot_MSG(`You searched for: ${data.login}, they have ${data.followers} followers, & ${data.public_repos} public repos`, "output")
} catch (error) {
  Bot_MSG(`Failed to get github info ${error.message}`, "output")

}

return;

}
    
};
     
  
var agent = {
   canyouhelp: function (input){
               Bot_MSG(`I am sorry I can not help you, I am still learning!`, "output")
               return
   }
}
         
         
         
         
         
         
         
     
        async function onIntent(nlp, input) {
           
           const output = input; 
           if (input.intent === 'None') {
            output.answer = 'I am not sure what you mean by that'
             
             // If no response was found - you could send the input to a API to store the input to make new responses (manually) & improve the chatbot!
           }
          
          
          
           // Handle your custom functions with Termino.JS on ChatBot intents here! 
          
          let functions = ['greetings.hello', 'search.github', 'agent.canyouhelp']
          
          for (const option in functions){
            if (input.intent === functions[option]) {        
              output.answer = await eval(functions[option] + `("${input.utterance}")`)  
            }
          } 
            if (output.answer != undefined){
            Bot_MSG(output.answer, "output");
              return input;
            }
            
        }
         
         
         
         

        const setupNLP = async corpus => {
            const container = containerBootstrap();
            container.register('fs', fs);
            container.use(Nlp);
            container.use(LangEn);
            const nlp = container.get('nlp');
            nlp.onIntent = onIntent;
            nlp.settings.autoSave = false;
            await nlp.addCorpus(corpus);
            nlp.train();
            return nlp;
        };
               // This is where all the responses for chatbot come from! You can make your own corpus data to fit your own chat bot needs! 
                // This is where all the responses for chatbot come from! You can make your own corpus data to fit your own chat bot needs! 

          let nlp = null;         
         (async () => {
             nlp = await setupNLP('https://raw.githubusercontent.com/jesus-seijas-sp/nlpjs-examples/master/01.quickstart/02.filecorpus/corpus-en.json');
        
        })();
 
 
  
         
         
   // initialize a Terminal via Termino.js
let term2 = Termino(document.getElementById("Example_Terminal_2"), null, DEF_SETTINGS)  
  

Termino.echo = function(msg){
  document.querySelector(".termino-console").innerHTML += msg
}
  
 
let BotGreetings = false;         
         
async function basicTerminalApp() {

  
  if(BotGreetings != true){
    Bot_MSG(`Hello & welcome! :) You can talk to me by typing below and pressing enter!`, "output")
    BotGreetings = true
  }
      

// call Termino.js / your terminal for inital input
let term2value = await term2.input("")

DEF_SETTINGS.prompt = `<div class="d-flex justify-content-end"><div class="message-bubble user">{{command}}</div></div>`

if (term2value){
  
   term2value = term2value.trim()
  
  
  
   if(term2value.length != 0){
    let response = await nlp.process('en', term2value);
     DEF_SETTINGS.prompt = `<div class="d-flex justify-content-end">${TimeStamp_Template}<div class="message-bubble user">{{command}}</div></div>`
   }
     
    
   // term2.speak(response)
  
}
  //  NEED TO FIGURE OUT FIX FOR CSS / SCROLL TO BOTTOM - BOOTSTRAP ISSUE - TERMINO.JS HAS BUILT IT SCROLL TO BOTTOM ON COMMANDS.
window.scrollTo(0, document.body.scrollHeight);
  
  
 // setTimeout(basicTerminalApp, term2value)
// repeat
basicTerminalApp()

}



  basicTerminalApp()
    
     
  </script> 
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Font Awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <link rel="stylesheet" href="static/style.css">
<style>

/* Chatbot message bubbles */
.message-bubble {
  position: relative;
  padding: 12px 18px;
  margin: 8px 0;
  background-color: #f1f0f0;
  border-radius: 6px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

/* Align bubbles to the right for user messages */
.message-bubble.user {
  align-self: flex-end;
  background-color: #0084ff;
  color: white;
}

/* animation for  BOT_MSG */ 

#chatbox > div:last-child > div:last-child {
  animation: slide-in-bot-msg 0.5s ease-out;
}
 
  
.timestamp-user {
    padding-bottom: 40px;
    /* text-align: right; */
    display: block;
    left: 60px;
    position: relative;  
 }
  
  
/* Keyframe animation  for bot msg */
@keyframes slide-in-bot-msg {
    from {
        right: -50px; /* Start offscreen */
        opacity: 0;
    }
    to {
        right: 0; /* End onscreen */
        opacity: 1;
    }
}    
    </style>
    <title>Chatbot</title>
  </head>
  <body>
    <!---- old color for pink is #ff0080 ----->
    <nav class="navbar sticky-top navbar-dark" style="background-color: #1ca315;">
      <a class="navbar-brand" href="/">
      <i class="fas fa-robot mr-2"></i>
        <b>Chatbot</b>
      </a>
    </nav>

    <div class="container-fluid mt-2" id="Example_Terminal_2">
      <div class="row">
        <div class="col">
          <div id="chatbox" class="termino-console"></div>
        </div>
      </div>
      <div id="chatbot-container">&nbsp;</div>
      <div>&nbsp;</div>
      <div>&nbsp;</div>
      <div class="row">
        <div class="col">
         
          <div class="ml-3 mb-3 mr-3 fixed-bottom">
            <textarea id="termino-input"  class="form-control termino-input"  rows="1" wrap="hard" placeholder="Enter your message here"></textarea>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script src="static/chatbot.js"></script>
  </body>

</html>
<!--
Responsive input bar with button beside for chatbot. 
var inputBar = document.createElement('div');
inputBar.className = 'input-group';
inputBar.innerHTML = '<input type="text" class="form-control" placeholder="Type here..." aria-label="Type here..." aria-describedby="basic-addon2">' +
  '<div class="input-group-append">' +
  '<button class="btn btn-outline-secondary" type="button">Send</button>' +
  '</div>';
document.body.appendChild(inputBar);




CSS TIME STAMP (RIGHT SIDE)

{
    /* margin-bottom: 19px; */
    padding-bottom: 40px;
    /* text-align: right; */
    display: block;
    left: 60px;
    position: relative;
}

--->
